# 百度语音API集成指南

## 概述

本项目已集成百度语音API，支持实时语音转文字功能。当百度语音API不可用时，会自动回退到模拟识别功能。

## 功能特性

- ✅ 实时语音录制
- ✅ 百度语音API识别
- ✅ 自动回退到模拟识别
- ✅ 语音识别状态显示
- ✅ 错误处理和重试机制

## 配置步骤

### 1. 获取百度语音API密钥

1. 访问 [百度AI开放平台](https://ai.baidu.com/)
2. 注册并登录账号
3. 创建新应用，选择"语音技术"
4. 获取以下信息：
   - **App ID**: 应用ID
   - **API Key**: 接口密钥
   - **Secret Key**: 安全密钥

### 2. 配置环境变量

1. 复制 `env.example` 文件为 `.env`
2. 在 `.env` 文件中配置百度语音API密钥：

```bash
# 百度语音API配置
BAIDU_APP_ID=your_baidu_app_id_here
BAIDU_API_KEY=your_baidu_api_key_here
BAIDU_SECRET_KEY=your_baidu_secret_key_here
```

### 3. 重启应用

配置完成后，重启应用以加载新的环境变量。

## 使用方法

### 在聊天界面使用

1. 打开聊天界面
2. 点击语音输入按钮
3. 按住按钮开始录音
4. 松开按钮结束录音
5. 等待语音识别结果

### 状态指示

- **使用百度语音API**: 显示"使用百度语音API"
- **使用模拟识别**: 显示"使用模拟识别"
- **识别中**: 按钮显示"识别中..."

## 技术实现

### 核心文件

- `utils/baiduSpeechApi.ts`: 百度语音API实现
- `utils/speechToText.ts`: 语音转文字主逻辑
- `components/VoiceInput.tsx`: 语音输入组件
- `config/env.ts`: 环境变量配置

### API流程

1. **获取访问令牌**: 使用API Key和Secret Key获取访问令牌
2. **音频处理**: 将录音文件转换为Base64编码
3. **语音识别**: 调用百度语音识别API
4. **结果处理**: 解析识别结果并返回文本

### 错误处理

- 网络错误自动重试
- API配置错误回退到模拟识别
- 权限错误提示用户设置
- 识别失败显示错误信息

## 测试

### 运行测试脚本

```bash
node scripts/test-baidu-speech.js
```

### 手动测试

1. 确保已配置百度语音API密钥
2. 启动应用
3. 进入聊天界面
4. 测试语音输入功能
5. 检查控制台日志

## 故障排除

### 常见问题

1. **"百度语音API未配置"**
   - 检查 `.env` 文件中的配置
   - 确保重启了应用

2. **"获取百度语音API令牌失败"**
   - 检查网络连接
   - 验证API Key和Secret Key是否正确

3. **"语音识别失败"**
   - 检查录音权限
   - 确保录音质量良好
   - 查看控制台错误信息

4. **"使用模拟识别"**
   - 这是正常的回退机制
   - 检查百度语音API配置

### 调试信息

应用会在控制台输出详细的调试信息：

```
🔧 环境变量配置: { BAIDU_APP_ID: "12345678...", ... }
🔍 百度语音API配置检查: { hasAppId: true, ... }
🎤 开始百度语音识别...
✅ 成功获取百度语音API令牌
✅ 百度语音识别成功: 你好世界
```

## 性能优化

- Token缓存机制，避免重复请求
- 音频文件Base64编码优化
- 错误重试机制
- 自动回退策略

## 安全注意事项

- 不要在代码中硬编码API密钥
- 使用环境变量管理敏感信息
- 定期更新API密钥
- 监控API使用量

## 相关链接

- [百度AI开放平台](https://ai.baidu.com/)
- [百度语音API文档](https://ai.baidu.com/tech/speech)
- [语音识别API文档](https://ai.baidu.com/ai-doc/SPEECH/Vk38lxily) 